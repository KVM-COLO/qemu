QA output created by 142
Formatting 'TEST_DIR/t.IMGFMT.base', fmt=IMGFMT size=134217728
Formatting 'TEST_DIR/t.IMGFMT.snap', fmt=IMGFMT size=134217728
Formatting 'TEST_DIR/t.IMGFMT', fmt=IMGFMT size=134217728 backing_file=TEST_DIR/t.IMGFMT.base

=== Simple test for all cache modes ===

Testing: -drive file=TEST_DIR/t.qcow2,cache=none
QEMU X.Y.Z monitor - type 'help' for more information
(qemu) q[K[Dqu[K[D[Dqui[K[D[D[Dquit[K

Testing: -drive file=TEST_DIR/t.qcow2,cache=directsync
QEMU X.Y.Z monitor - type 'help' for more information
(qemu) q[K[Dqu[K[D[Dqui[K[D[D[Dquit[K

Testing: -drive file=TEST_DIR/t.qcow2,cache=writeback
QEMU X.Y.Z monitor - type 'help' for more information
(qemu) q[K[Dqu[K[D[Dqui[K[D[D[Dquit[K

Testing: -drive file=TEST_DIR/t.qcow2,cache=writethrough
QEMU X.Y.Z monitor - type 'help' for more information
(qemu) q[K[Dqu[K[D[Dqui[K[D[D[Dquit[K

Testing: -drive file=TEST_DIR/t.qcow2,cache=unsafe
QEMU X.Y.Z monitor - type 'help' for more information
(qemu) q[K[Dqu[K[D[Dqui[K[D[D[Dquit[K

Testing: -drive file=TEST_DIR/t.qcow2,cache=invalid_value
QEMU_PROG: -drive file=TEST_DIR/t.qcow2,cache=invalid_value: invalid cache option


=== Check inheritance of cache modes ===


--- Configure cache modes on the command line ---

cache.direct=on on none0
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct

cache.direct=on on file
    Cache mode:       writeback
    Cache mode:       writeback, direct
    Cache mode:       writeback
    Cache mode:       writeback

cache.direct=on on backing
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct

cache.direct=on on backing-file
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, direct


cache.writeback=off on none0
    Cache mode:       writethrough
    Cache mode:       writeback
    Cache mode:       writethrough
    Cache mode:       writeback

cache.writeback=off on file
    Cache mode:       writeback
    Cache mode:       writethrough
    Cache mode:       writeback
    Cache mode:       writeback

cache.writeback=off on backing
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writethrough
    Cache mode:       writeback

cache.writeback=off on backing-file
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writethrough


cache.no-flush=on on none0
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback, ignore flushes

cache.no-flush=on on file
    Cache mode:       writeback
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback
    Cache mode:       writeback

cache.no-flush=on on backing
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback, ignore flushes

cache.no-flush=on on backing-file
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, ignore flushes

--- Cache modes after reopen (live snapshot) ---

cache.direct=on on none0
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct

cache.direct=on on file
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, direct
    Cache mode:       writeback
    Cache mode:       writeback

cache.direct=on on backing
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct

cache.direct=on on backing-file
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, direct


cache.writeback=off on none0
    Cache mode:       writethrough
    Cache mode:       writethrough
    Cache mode:       writeback
    Cache mode:       writethrough
    Cache mode:       writeback

cache.writeback=off on file
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writethrough
    Cache mode:       writeback
    Cache mode:       writeback

cache.writeback=off on backing
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writethrough
    Cache mode:       writeback

cache.writeback=off on backing-file
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writethrough


cache.no-flush=on on none0
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback, ignore flushes

cache.no-flush=on on file
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback
    Cache mode:       writeback

cache.no-flush=on on backing
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback, ignore flushes

cache.no-flush=on on backing-file
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, ignore flushes

--- Change cache modes with reopen (qemu-io command, flags) ---

cache.direct=on on none0
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct

cache.direct=on on file
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct

cache.direct=on on backing
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct

cache.direct=on on backing-file
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct


cache.writeback=off on none0
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct

cache.writeback=off on file
    Cache mode:       writeback, direct
    Cache mode:       writethrough, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct

cache.writeback=off on backing
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writethrough, direct
    Cache mode:       writeback, direct

cache.writeback=off on backing-file
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writethrough, direct


cache.no-flush=on on none0
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct

cache.no-flush=on on file
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct, ignore flushes
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct

cache.no-flush=on on backing
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct, ignore flushes
    Cache mode:       writeback, direct, ignore flushes

cache.no-flush=on on backing-file
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct, ignore flushes

--- Change cache modes with reopen (qemu-io command, options) ---

cache.direct=on on none0
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct

cache.direct=on on file
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct

cache.direct=on on backing
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct

cache.direct=on on backing-file
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct


cache.writeback=off on none0
    Cache mode:       writethrough, direct
    Cache mode:       writeback, direct
    Cache mode:       writethrough, direct
    Cache mode:       writeback, direct

cache.writeback=off on file
    Cache mode:       writeback, direct
    Cache mode:       writethrough, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct

cache.writeback=off on backing
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writethrough, direct
    Cache mode:       writeback, direct

cache.writeback=off on backing-file
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writethrough, direct


cache.no-flush=on on none0
    Cache mode:       writeback, direct, ignore flushes
    Cache mode:       writeback, direct, ignore flushes
    Cache mode:       writeback, direct, ignore flushes
    Cache mode:       writeback, direct, ignore flushes

cache.no-flush=on on file
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct, ignore flushes
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct

cache.no-flush=on on backing
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct, ignore flushes
    Cache mode:       writeback, direct, ignore flushes

cache.no-flush=on on backing-file
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct, ignore flushes

--- Change cache modes after snapshot ---

cache.direct=on on none0
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct

cache.direct=on on file
    Cache mode:       writeback, direct
    Cache mode:       writeback
    Cache mode:       writeback, direct
    Cache mode:       writeback
    Cache mode:       writeback

cache.direct=on on backing
    Cache mode:       writeback, direct
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct

cache.direct=on on backing-file
    Cache mode:       writeback, direct
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, direct


cache.writeback=off on none0
    Cache mode:       writeback, direct
    Cache mode:       writethrough
    Cache mode:       writeback
    Cache mode:       writethrough
    Cache mode:       writeback

cache.writeback=off on file
    Cache mode:       writeback, direct
    Cache mode:       writeback
    Cache mode:       writethrough
    Cache mode:       writeback
    Cache mode:       writeback

cache.writeback=off on backing
    Cache mode:       writeback, direct
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writethrough
    Cache mode:       writeback

cache.writeback=off on backing-file
    Cache mode:       writeback, direct
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writethrough


cache.no-flush=on on none0
    Cache mode:       writeback, direct
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback, ignore flushes

cache.no-flush=on on file
    Cache mode:       writeback, direct
    Cache mode:       writeback
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback
    Cache mode:       writeback

cache.no-flush=on on backing
    Cache mode:       writeback, direct
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback, ignore flushes

cache.no-flush=on on backing-file
    Cache mode:       writeback, direct
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, ignore flushes

--- Change cache mode in parent, child has explicit option in JSON ---

Testing: -drive if=none,file=blkdebug::json:{"filename":"TEST_DIR/t.qcow2",,"cache":{"writeback":false,,"direct":false}},node-name=image,file.node-name=blkdebug,file.image.node-name=file
QEMU X.Y.Z monitor - type 'help' for more information
(qemu) q[K[Dqe[K[D[Dqem[K[D[D[Dqemu[K[D[D[D[Dqemu-[K[D[D[D[D[Dqemu-i[K[D[D[D[D[D[Dqemu-io[K[D[D[D[D[D[D[Dqemu-io [K[D[D[D[D[D[D[D[Dqemu-io n[K[D[D[D[D[D[D[D[D[Dqemu-io no[K[D[D[D[D[D[D[D[D[D[Dqemu-io non[K[D[D[D[D[D[D[D[D[D[D[Dqemu-io none[K[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0[K[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 [K[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "r[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "re[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reo[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reop[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reope[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen [K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o [K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o c[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o ca[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cac[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cach[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.w[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.wr[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.wri[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writ[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.write[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeb[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeba[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writebac[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=o[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=of[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,c[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,ca[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cac[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cach[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.d[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.di[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.dir[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.dire[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.direc[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.direct[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.direct=[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.direct=o[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.direct=on[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.direct=on,[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.direct=on,c[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.direct=on,ca[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.direct=on,cac[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.direct=on,cach[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.direct=on,cache[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.direct=on,cache.[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.direct=on,cache.n[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.direct=on,cache.no[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.direct=on,cache.no-[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.direct=on,cache.no-f[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.direct=on,cache.no-fl[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.direct=on,cache.no-flu[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.direct=on,cache.no-flus[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.direct=on,cache.no-flush[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.direct=on,cache.no-flush=[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.direct=on,cache.no-flush=o[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.direct=on,cache.no-flush=on[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dqemu-io none0 "reopen -o cache.writeback=off,cache.direct=on,cache.no-flush=on"[K
(qemu) i[K[Din[K[D[Dinf[K[D[D[Dinfo[K[D[D[D[Dinfo [K[D[D[D[D[Dinfo b[K[D[D[D[D[D[Dinfo bl[K[D[D[D[D[D[D[Dinfo blo[K[D[D[D[D[D[D[D[Dinfo bloc[K[D[D[D[D[D[D[D[D[Dinfo block[K[D[D[D[D[D[D[D[D[D[Dinfo block [K[D[D[D[D[D[D[D[D[D[D[Dinfo block i[K[D[D[D[D[D[D[D[D[D[D[D[Dinfo block im[K[D[D[D[D[D[D[D[D[D[D[D[D[Dinfo block ima[K[D[D[D[D[D[D[D[D[D[D[D[D[D[Dinfo block imag[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dinfo block image[K

image: blkdebug::TEST_DIR/t.qcow2 (qcow2)
    Cache mode:       writethrough, direct, ignore flushes
    Backing file:     TEST_DIR/t.qcow2.base (chain depth: 1)
(qemu) i[K[Din[K[D[Dinf[K[D[D[Dinfo[K[D[D[D[Dinfo [K[D[D[D[D[Dinfo b[K[D[D[D[D[D[Dinfo bl[K[D[D[D[D[D[D[Dinfo blo[K[D[D[D[D[D[D[D[Dinfo bloc[K[D[D[D[D[D[D[D[D[Dinfo block[K[D[D[D[D[D[D[D[D[D[Dinfo block [K[D[D[D[D[D[D[D[D[D[D[Dinfo block b[K[D[D[D[D[D[D[D[D[D[D[D[Dinfo block bl[K[D[D[D[D[D[D[D[D[D[D[D[D[Dinfo block blk[K[D[D[D[D[D[D[D[D[D[D[D[D[D[Dinfo block blkd[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dinfo block blkde[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dinfo block blkdeb[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dinfo block blkdebu[K[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[D[Dinfo block blkdebug[K

blkdebug: blkdebug::TEST_DIR/t.qcow2 (blkdebug)
    Cache mode:       writeback, direct, ignore flushes
(qemu) i[K[Din[K[D[Dinf[K[D[D[Dinfo[K[D[D[D[Dinfo [K[D[D[D[D[Dinfo b[K[D[D[D[D[D[Dinfo bl[K[D[D[D[D[D[D[Dinfo blo[K[D[D[D[D[D[D[D[Dinfo bloc[K[D[D[D[D[D[D[D[D[Dinfo block[K[D[D[D[D[D[D[D[D[D[Dinfo block [K[D[D[D[D[D[D[D[D[D[D[Dinfo block f[K[D[D[D[D[D[D[D[D[D[D[D[Dinfo block fi[K[D[D[D[D[D[D[D[D[D[D[D[D[Dinfo block fil[K[D[D[D[D[D[D[D[D[D[D[D[D[D[Dinfo block file[K

file: TEST_DIR/t.qcow2 (file)
    Cache mode:       writethrough, ignore flushes
(qemu) q[K[Dqu[K[D[Dqui[K[D[D[Dquit[K


=== Check that referenced BDSes don't inherit ===


--- Configure cache modes on the command line ---

cache.direct=on on blk
    Cache mode:       writeback, direct
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback

cache.direct=on on file
    Cache mode:       writeback
    Cache mode:       writeback, direct
    Cache mode:       writeback
    Cache mode:       writeback

cache.direct=on on backing
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, direct
    Cache mode:       writeback

cache.direct=on on backing-file
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, direct


cache.writeback=off on blk
    Cache mode:       writethrough
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback

cache.writeback=off on file
    Cache mode:       writeback
    Cache mode:       writethrough
    Cache mode:       writeback
    Cache mode:       writeback

cache.writeback=off on backing
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writethrough
    Cache mode:       writeback

cache.writeback=off on backing-file
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writethrough


cache.no-flush=on on blk
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback

cache.no-flush=on on file
    Cache mode:       writeback
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback
    Cache mode:       writeback

cache.no-flush=on on backing
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback

cache.no-flush=on on backing-file
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, ignore flushes

--- Cache modes after reopen (live snapshot) ---

cache.direct=on on blk
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback

cache.direct=on on file
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, direct
    Cache mode:       writeback
    Cache mode:       writeback

cache.direct=on on backing
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, direct
    Cache mode:       writeback

cache.direct=on on backing-file
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, direct


cache.writeback=off on blk
    Cache mode:       writethrough
    Cache mode:       writethrough
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback

cache.writeback=off on file
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writethrough
    Cache mode:       writeback
    Cache mode:       writeback

cache.writeback=off on backing
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writethrough
    Cache mode:       writeback

cache.writeback=off on backing-file
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writethrough


cache.no-flush=on on blk
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback

cache.no-flush=on on file
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback
    Cache mode:       writeback

cache.no-flush=on on backing
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback

cache.no-flush=on on backing-file
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, ignore flushes

--- Change cache modes with reopen (qemu-io command, flags) ---

cache.direct=on on blk
    Cache mode:       writeback, direct
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback

cache.direct=on on file
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback
    Cache mode:       writeback

cache.direct=on on backing
    Cache mode:       writeback, direct
    Cache mode:       writeback
    Cache mode:       writeback, direct
    Cache mode:       writeback

cache.direct=on on backing-file
    Cache mode:       writeback, direct
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, direct


cache.writeback=off on blk
    Cache mode:       writeback, direct
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback

cache.writeback=off on file
    Cache mode:       writeback, direct
    Cache mode:       writethrough
    Cache mode:       writeback
    Cache mode:       writeback

cache.writeback=off on backing
    Cache mode:       writeback, direct
    Cache mode:       writeback
    Cache mode:       writethrough
    Cache mode:       writeback

cache.writeback=off on backing-file
    Cache mode:       writeback, direct
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writethrough


cache.no-flush=on on blk
    Cache mode:       writeback, direct
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback

cache.no-flush=on on file
    Cache mode:       writeback, direct
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback
    Cache mode:       writeback

cache.no-flush=on on backing
    Cache mode:       writeback, direct
    Cache mode:       writeback
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback

cache.no-flush=on on backing-file
    Cache mode:       writeback, direct
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, ignore flushes

=== Reopening children instead of the root ===


--- Basic reopen ---

cache.direct=on on none0
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct

cache.direct=on on file
    Cache mode:       writeback
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct

cache.direct=on on backing
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct

cache.direct=on on backing-file
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct


cache.writeback=off on none0
    Cache mode:       writethrough
    Cache mode:       writeback
    Cache mode:       writethrough, direct
    Cache mode:       writeback, direct

cache.writeback=off on file
    Cache mode:       writeback
    Cache mode:       writethrough
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct

cache.writeback=off on backing
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writethrough, direct
    Cache mode:       writeback, direct

cache.writeback=off on backing-file
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, direct
    Cache mode:       writethrough, direct


cache.no-flush=on on none0
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback, direct, ignore flushes
    Cache mode:       writeback, direct, ignore flushes

cache.no-flush=on on file
    Cache mode:       writeback
    Cache mode:       writeback, ignore flushes
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct

cache.no-flush=on on backing
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, direct, ignore flushes
    Cache mode:       writeback, direct, ignore flushes

cache.no-flush=on on backing-file
    Cache mode:       writeback
    Cache mode:       writeback
    Cache mode:       writeback, direct
    Cache mode:       writeback, direct, ignore flushes

--- Change cache mode after reopening child ---

    Cache mode:       writeback, direct
    Cache mode:       writethrough
    Cache mode:       writeback, direct
    Cache mode:       writeback, ignore flushes
*** done
